<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Desktop</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #1e1e1e;
    font-family: sans-serif;
    overflow: hidden;
  }
  #desktop {
    position: relative;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,#4b6cb7,#182848);
  }
  .app {
    position: absolute;
    width: 80px;
    text-align: center;
    cursor: pointer;
    color: white;
  }
  .app img {
    width: 64px;
    height: 64px;
    display: block;
    margin: 0 auto;
  }
  .window {
    position: absolute;
    background: #222;
    border: 2px solid #555;
    color: white;
    z-index: 1000;
    display: none;
    overflow: hidden;
  }
  .window .titlebar {
    background: #333;
    padding: 5px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: move;
  }
  .window .titlebar button {
    background: #555;
    border: none;
    color: white;
    cursor: pointer;
    width: 25px;
    height: 25px;
    font-weight: bold;
  }
  .window .content {
    padding: 10px;
    height: calc(100% - 32px);
    overflow-y: auto;
  }
  #start {
    position: absolute;
    bottom: 0;
    left: 0;
    background: #0078D7;
    color: white;
    padding: 5px 10px;
    cursor: pointer;
    font-weight: bold;
  }
  #startMenu {
    position: absolute;
    bottom: 40px;
    left: 0;
    background: #333;
    border: 1px solid #555;
    color: white;
    display: none;
    width: 200px;
  }
  #startMenu button {
    width: 100%;
    background: none;
    border: none;
    color: white;
    padding: 10px;
    cursor: pointer;
    text-align: left;
  }
  #startMenu button:hover { background: #555; }
  .context-menu {
    position: absolute;
    background: #333;
    border: 1px solid #555;
    display: none;
    z-index: 2000;
  }
  .context-menu button {
    display: block;
    width: 150px;
    border: none;
    background: none;
    color: white;
    padding: 5px 10px;
    cursor: pointer;
    text-align: left;
  }
  .context-menu button:hover { background: #555; }
  /* App Store */
  #appStore .content {
    max-height: 400px;
    overflow-y: auto;
  }
  #appStore .app-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  #appStore .app-item img {
    width: 40px;
    height: 40px;
    margin-right: 10px;
  }
  #appStore .app-item button {
    margin-left: auto;
    background: #0078D7;
    border: none;
    color: white;
    cursor: pointer;
    padding: 5px 10px;
  }
  .countdown-bar {
    width: 100%;
    height: 20px;
    background: #555;
    margin-top: 10px;
    position: relative;
  }
  .countdown-bar-inner {
    height: 100%;
    background: #0078D7;
    width: 0%;
  }
</style>
</head>
<body>
<div id="desktop"></div>

<div id="start">Start</div>
<div id="startMenu">
  <button id="returnWeb">Return to Basic Web</button>
</div>

<div id="contextMenu" class="context-menu">
  <button id="openProps">Properties</button>
  <button id="deleteApp">Delete</button>
</div>

<!-- Windows template -->
<div id="appWindow" class="window">
  <div class="titlebar">
    <span class="title"></span>
    <button class="closeBtn">X</button>
  </div>
  <div class="content"></div>
</div>

<script>
const desktop = document.getElementById('desktop');
const start = document.getElementById('start');
const startMenu = document.getElementById('startMenu');
const contextMenu = document.getElementById('contextMenu');
const appWindow = document.getElementById('appWindow');

let apps = JSON.parse(localStorage.getItem('desktopApps') || '[]');
const factoryResetApp = {
  name: 'Factory Reset',
  icon: 'https://cdn-icons-png.flaticon.com/512/565/565547.png',
  properties: 'System App - Cannot be deleted',
  deletable: false,
  open: () => openWindow('Factory Reset', '<div>Windows has been factory reset!<div class="countdown-bar"><div class="countdown-bar-inner" id="countdownInner"></div></div></div>', true)
};

function saveApps() { localStorage.setItem('desktopApps', JSON.stringify(apps)); }

function renderDesktop() {
  desktop.innerHTML = '';
  const allApps = [factoryResetApp, ...apps];
  allApps.forEach((app, i) => {
    const div = document.createElement('div');
    div.className = 'app';
    div.style.left = (i*100 + 20)+'px';
    div.style.top = '20px';
    div.innerHTML = `<img src="${app.icon}" alt=""><span>${app.name}</span>`;
    div.addEventListener('dblclick', () => app.open());
    div.addEventListener('contextmenu', (e)=>{
      e.preventDefault();
      contextMenu.style.display='block';
      contextMenu.style.left=e.pageX+'px';
      contextMenu.style.top=e.pageY+'px';
      contextMenu.currentApp = app;
    });
    desktop.appendChild(div);
  });
}

// Start menu
start.addEventListener('click', ()=> startMenu.style.display = startMenu.style.display==='block'?'none':'block');
document.getElementById('returnWeb').addEventListener('click', ()=> location.href='index.html');

// Context menu
document.getElementById('openProps').addEventListener('click', ()=>{
  const app = contextMenu.currentApp;
  alert(`${app.name}\n${app.properties}`);
  contextMenu.style.display='none';
});
document.getElementById('deleteApp').addEventListener('click', ()=>{
  const app = contextMenu.currentApp;
  if(!app.deletable) return;
  apps = apps.filter(a=>a!==app);
  saveApps();
  renderDesktop();
  contextMenu.style.display='none';
});
desktop.addEventListener('click', ()=> contextMenu.style.display='none');

// Open window
function openWindow(title, content, fullscreen=false) {
  appWindow.style.display='block';
  appWindow.style.width = fullscreen?'100%':'600px';
  appWindow.style.height = fullscreen?'100%':'400px';
  appWindow.style.left = fullscreen?'0':'50px';
  appWindow.style.top = fullscreen?'0':'50px';
  appWindow.querySelector('.title').innerText = title;
  appWindow.querySelector('.content').innerHTML = content;
  const closeBtn = appWindow.querySelector('.closeBtn');
  closeBtn.style.display = fullscreen?'none':'block';
  if(fullscreen && title==='Factory Reset'){
    let innerBar = document.getElementById('countdownInner');
    let progress=0;
    const interval = setInterval(()=>{
      progress+=10;
      innerBar.style.width = progress+'%';
      if(progress>=100){ clearInterval(interval); location.href='index.html'; }
    },1000);
  }
}

// Default apps in App Store
const defaultApps = [
  {
    name:'Minecraft 1.8.8',
    icon:'https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c7/Grass_Block.png/revision/latest/scale-to-width-down/268?cb=20230226144250',
    properties:'Made 13 Oct 2025, unblocked Minecraft in your browser!',
    deletable:true,
    open:()=> openWindow('Minecraft 1.8.8','<h2>This App Is Unavailable</h2><p>Please Wait While I Find Another Unblocked Version!</p>',true)
  },
  {
    name:'Fortnite Launcher',
    icon:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvb1r9fOqmmLDhvcAbmV6HRkRuliJAjD-uCQ&s',
    properties:'Made 14 Oct 2025, Play Fortnite!',
    deletable:true,
    open:()=> openWindow('Fortnite Launcher',`
      <h2>Disclaimer!</h2>
      <p>You need to be signed in to an Amazon account with Prime to use this service!</p>
      <p>Link your Epic Games account to your Amazon account on <a href="https://luna.amazon.co.uk" target="_blank">luna.amazon.co.uk</a></p>
      <button onclick="window.open('https://luna.amazon.co.uk/game/fortnite?lang=en-US&ref=tmp_ext_epic&autoplay=1','_blank')">Launch Anyway</button>
    `,true)
  },
  {
    name:'Request an App',
    icon:'https://cdn-icons-png.flaticon.com/512/1828/1828817.png',
    properties:'Made 14 Oct 2025, suggest an app to be added!',
    deletable:true,
    open:()=> openWindow('Request an App','<iframe src="request.html" style="width:100%;height:100%;border:none;"></iframe>')
  },
  {
    name:'Device Info',
    icon:'https://cdn-icons-png.flaticon.com/512/2919/2919605.png',
    properties:'Made 14 Oct 2025, View your device info!',
    deletable:true,
    open:()=> openWindow('Device Info','<iframe src="deviceinfo.html" style="width:100%;height:100%;border:none;"></iframe>')
  }
];

// Install apps via App Store
function openAppStore() {
  const content = defaultApps.map(app=>{
    return `<div class="app-item">
      <img src="${app.icon}">
      <div>${app.name}</div>
      <button onclick="installApp('${app.name}')">Install</button>
    </div>`;
  }).join('');
  openWindow('App Store', content, false);
}

function installApp(name){
  const app = defaultApps.find(a=>a.name===name);
  if(app && !apps.includes(app)){
    apps.push(app);
    saveApps();
    renderDesktop();
  }
}

// Add App Store button
apps.push({
  name:'App Store',
  icon:'https://cdn-icons-png.flaticon.com/512/833/833524.png',
  properties:'App Store',
  deletable:true,
  open: openAppStore
});

renderDesktop();
</script>
</body>
</html>
